<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Traffic Dashboard | API & Search</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #000; }
        #map { height: 100vh; width: 100%; position: absolute; z-index: 1; }

        /* √úst Panel */
        .header-bar {
            position: absolute; top: 0; left: 0; right: 0;
            background: rgba(18, 18, 18, 0.85); backdrop-filter: blur(10px);
            color: white; padding: 12px 20px; z-index: 1001;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #4285F4; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .header-bar h1 { margin: 0; font-size: 16px; font-weight: 600; color: #e8eaed; letter-spacing: 0.5px; }
        .api-tag { background: #34a853; font-size: 10px; padding: 3px 8px; border-radius: 4px; font-weight: bold; }

        /* Favoriler Paneli */
        .fav-panel {
            position: absolute; top: 80px; left: 20px;
            background: #fff; width: 250px; max-height: 450px;
            z-index: 1000; border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            padding: 15px; overflow-y: auto; border: 1px solid #ddd;
        }
        .fav-header { font-weight: 800; color: #202124; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .fav-list-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; border-radius: 8px; margin-bottom: 6px; 
            background: #f8f9fa; border: 1px solid transparent; transition: 0.3s;
        }
        .fav-list-item:hover { border-color: #4285F4; background: #eef4ff; cursor: pointer; transform: scale(1.02); }
        .city-name { font-size: 14px; font-weight: 600; color: #3c4043; }
        .delete-icon { color: #d93025; font-size: 18px; font-weight: bold; padding: 0 5px; cursor: pointer; }

        /* Arama Kutusu √ñzelle≈ütirme */
        .leaflet-control-geocoder { border-radius: 8px !important; box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important; margin-top: 80px !important; margin-right: 20px !important; }
    </style>
</head>
<body>

    <div class="header-bar">
        <h1>üåç D√úNYA CANLI TRAFƒ∞K YOƒûUNLUƒûU</h1>
        <div class="api-tag">API: AKTƒ∞F</div>
    </div>

    <div class="fav-panel">
        <div class="fav-header">‚≠ê Favori ≈ûehirler</div>
        <div id="favList"></div>
        <p style="font-size: 10px; color: #70757a; margin-top: 15px;">* ≈ûehir eklemek i√ßin haritaya saƒü tƒ±klayƒ±n.</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script>
        // 1. API ve Harita Ayarlarƒ±
        const API_KEY = "uWD6Bs17qsOMpQY9yMZJejwu6YnErjWk";
        var map = L.map('map', { zoomControl: false }).setView([41.0082, 28.9784], 11);

        // Google Trafik Katmanƒ± (Senin API Anahtarƒ±nla)
        L.tileLayer('https://{s}.google.com/vt/lyrs=m,traffic&x={x}&y={y}&z={z}&key=' + API_KEY, {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            attribution: '¬© Google Maps Traffic'
        }).addTo(map);

        // Zoom kontrol√ºn√º saƒü alta alalƒ±m
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // 2. Arama Kutusu (Geocoder) Entegrasyonu
        var geocoder = L.Control.geocoder({
            defaultMarkGeocode: false,
            placeholder: "≈ûehir veya adres ara...",
            errorMessage: "Bulunamadƒ±."
        })
        .on('markgeocode', function(e) {
            var latlng = e.geocode.center;
            map.flyTo(latlng, 13); // Aramadan sonra ≈üehre yumu≈üak ge√ßi≈ü yap
        })
        .addTo(map);

        // 3. Favori Sistemi (Stateful & API Ready)
        let favs = JSON.parse(localStorage.getItem('traffic_app_favs')) || [];

        function refreshFavs() {
            const list = document.getElementById('favList');
            list.innerHTML = favs.length === 0 ? '<p style="color:gray; font-size:12px;">Hen√ºz ≈üehir eklenmedi.</p>' : '';
            
            favs.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'fav-list-item';
                div.innerHTML = `
                    <span class="city-name" onclick="map.flyTo([${item.lat}, ${item.lng}], 13)">üìç ${item.name}</span>
                    <span class="delete-icon" onclick="deleteFav(${i})">√ó</span>
                `;
                list.appendChild(div);
            });
            localStorage.setItem('traffic_app_favs', JSON.stringify(favs));
        }

        function deleteFav(i) {
            favs.splice(i, 1);
            refreshFavs();
        }

        // Saƒü tƒ±kla yeni favori ekleme
        map.on('contextmenu', (e) => {
            const cityName = prompt("Bu b√∂lgeyi hangi isimle kaydetmek istersiniz?");
            if(cityName) {
                favs.push({ name: cityName, lat: e.latlng.lat, lng: e.latlng.lng });
                refreshFavs();
            }
        });

        // Ba≈ülangƒ±√ßta listeyi y√ºkle
        refreshFavs();
    </script>
</body>
</html>
