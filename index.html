<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CanlÄ± Trafik YoÄŸunluÄŸu</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #map { height: 100vh; width: 100%; }

        /* Silme Butonu Stili */
        .delete-btn {
            background-color: #ff4444; color: white; border: none;
            padding: 5px 10px; border-radius: 4px; cursor: pointer;
            font-size: 12px; margin-top: 5px; width: 100%;
        }
        .delete-btn:hover { background-color: #cc0000; }

        /* Bilgi Paneli */
        .info-panel {
            position: absolute; top: 10px; left: 60px;
            background: rgba(255,255,255,0.9); padding: 10px;
            border-radius: 5px; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); font-size: 13px;
        }
    </style>
</head>
<body>

    <div class="info-panel">
        <b>GÃ¶rÃ¼nÃ¼m DeÄŸiÅŸtirme:</b><br>
        SaÄŸ Ã¼stteki â¬œ ikonuna gelerek<br>
        Gece, Uydu veya Gri mod seÃ§ebilirsiniz.
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script>
        // --- 1. HARÄ°TA KATMANLARI (TILE LAYERS) ---
        
        // A. Standart Sokak (OpenStreetMap)
        var standartMod = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap'
        });

        // B. Uydu GÃ¶rÃ¼ntÃ¼sÃ¼ (Esri World Imagery)
        var uyduMod = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles Â© Esri'
        });

        // C. Gece Modu (CartoDB Dark Matter)
        var geceMod = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap, Â© CartoDB'
        });

        // D. Monokrom / Gri Mod (CartoDB Positron)
        var griMod = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap, Â© CartoDB'
        });

        // HaritayÄ± BaÅŸlat (VarsayÄ±lan olarak 'Standart' ile baÅŸlasÄ±n)
        var map = L.map('map', {
            center: [41.0082, 28.9784],
            zoom: 12,
            layers: [standartMod] // Ä°lk aÃ§Ä±lÄ±ÅŸ katmanÄ±
        });

        // --- 2. KATMAN KONTROL MENÃœSÃœ ---
        var baseMaps = {
            "ğŸŒ Sokak GÃ¶rÃ¼nÃ¼mÃ¼": standartMod,
            "ğŸ›°ï¸ Uydu GÃ¶rÃ¼ntÃ¼sÃ¼": uyduMod,
            "ğŸŒ‘ Gece Modu": geceMod,
            "âšª Monokrom (Gri)": griMod
        };
        
        // MenÃ¼yÃ¼ haritaya ekle (SaÄŸ Ãœst KÃ¶ÅŸe)
        L.control.layers(baseMaps).addTo(map);

        // --- 3. ESKÄ° Ã–ZELLÄ°KLERÄ°N KORUNMASI (ARAMA & Ä°ÅARETLEME) ---

        // Arama Ã–zelliÄŸi
        var aramaKatmani = null;
        L.Control.geocoder({ defaultMarkGeocode: false })
        .on('markgeocode', function(e) {
            if (aramaKatmani) map.removeLayer(aramaKatmani);
            var bbox = e.geocode.bbox;
            aramaKatmani = L.polygon([
                bbox.getSouthEast(), bbox.getNorthEast(),
                bbox.getNorthWest(), bbox.getSouthWest()
            ]).addTo(map);
            map.fitBounds(aramaKatmani.getBounds());
            aramaKatmani.on('click', function() { map.removeLayer(this); aramaKatmani = null; });
        })
        .addTo(map);

        // SaÄŸ TÄ±k ile Ä°ÅŸaretleme ve Silme
        map.on('contextmenu', function(e) {
            var yeniMarker = L.marker(e.latlng).addTo(map);
            var icerik = document.createElement('div');
            icerik.innerHTML = `<b>Konum Ä°ÅŸaretlendi</b><br>Lat: ${e.latlng.lat.toFixed(4)}`;
            var silButonu = document.createElement('button');
            silButonu.className = 'delete-btn';
            silButonu.innerHTML = 'Bu Ä°ÅŸareti Sil';
            silButonu.onclick = function() { map.removeLayer(yeniMarker); };
            icerik.appendChild(silButonu);
            yeniMarker.bindPopup(icerik).openPopup();
        });

    </script>
</body>
</html>
