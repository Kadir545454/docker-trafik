<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CanlÄ± Trafik YoÄŸunluÄŸu</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #map { height: 100vh; width: 100%; }

        /* Silme Butonu Stili */
        .delete-btn {
            background-color: #ff4444; color: white; border: none;
            padding: 5px 10px; border-radius: 4px; cursor: pointer;
            font-size: 12px; margin-top: 5px; width: 100%;
        }
        .delete-btn:hover { background-color: #cc0000; }

        /* Bilgi Paneli */
        .info-panel {
            position: absolute; top: 10px; left: 60px;
            background: rgba(255,255,255,0.9); padding: 10px;
            border-radius: 5px; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); font-size: 13px;
            border-left: 5px solid #4285F4; /* Google Mavisi */
        }
    </style>
</head>
<body>

    <div class="info-panel">
        <b>ğŸš¦ CanlÄ± Trafik Modu Aktif</b><br>
        SaÄŸ Ã¼stteki menÃ¼den harita<br>
        tipini deÄŸiÅŸtirebilirsin.
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script>
        // --- 1. HARÄ°TA KATMANLARI ---
        
        // A. Google CanlÄ± Trafik (VarsayÄ±lan yapÄ±lacak)
        var googleTrafik = L.tileLayer('https://{s}.google.com/vt/lyrs=m,traffic&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            attribution: 'Â© Google Maps'
        });

        // B. Google Hibrit (Uydu + Yollar)
        var googleUydu = L.tileLayer('https://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            attribution: 'Â© Google Maps'
        });

        // C. Gece Modu
        var geceMod = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap, Â© CartoDB'
        });

        // HaritayÄ± BaÅŸlat (Google Trafik ile baÅŸlasÄ±n)
        var map = L.map('map', {
            center: [41.0082, 28.9784], // Ä°stanbul Merkez
            zoom: 12,
            layers: [googleTrafik] // Ä°lk aÃ§Ä±lÄ±ÅŸta trafik gÃ¶rÃ¼nsÃ¼n
        });

        // --- 2. KATMAN KONTROL MENÃœSÃœ ---
        var baseMaps = {
            "ğŸš¦ Google Trafik": googleTrafik,
            "ğŸ›°ï¸ Uydu GÃ¶rÃ¼ntÃ¼sÃ¼": googleUydu,
            "ğŸŒ‘ Gece Modu": geceMod
        };
        
        L.control.layers(baseMaps).addTo(map);

        // --- 3. ARAMA VE Ä°ÅARETLEME Ã–ZELLÄ°KLERÄ° ---

        // Arama Kutusu
        var aramaKatmani = null;
        L.Control.geocoder({ defaultMarkGeocode: false })
        .on('markgeocode', function(e) {
            if (aramaKatmani) map.removeLayer(aramaKatmani);
            var bbox = e.geocode.bbox;
            aramaKatmani = L.polygon([
                bbox.getSouthEast(), bbox.getNorthEast(),
                bbox.getNorthWest(), bbox.getSouthWest()
            ]).addTo(map);
            map.fitBounds(aramaKatmani.getBounds());
            aramaKatmani.on('click', function() { map.removeLayer(this); aramaKatmani = null; });
        })
        .addTo(map);

        // SaÄŸ TÄ±k Ä°ÅŸaretleme
        map.on('contextmenu', function(e) {
            var yeniMarker = L.marker(e.latlng).addTo(map);
            var icerik = document.createElement('div');
            icerik.innerHTML = `<b>Konum Ä°ÅŸaretlendi</b><br>Lat: ${e.latlng.lat.toFixed(4)}`;
            var silButonu = document.createElement('button');
            silButonu.className = 'delete-btn';
            silButonu.innerHTML = 'Sil';
            silButonu.onclick = function() { map.removeLayer(yeniMarker); };
            icerik.appendChild(silButonu);
            yeniMarker.bindPopup(icerik).openPopup();
        });

    </script>
</body>
</html>
